description = 'EnMasse templates'
apply plugin: 'distribution'

task buildJsonnet(type: Exec) {
    workingDir 'jsonnet'
    commandLine 'make'
}

task buildTemplates(type: Exec) {
    // TODO: Move Makefile stuff into this
    dependsOn buildJsonnet
    workingDir projectDir
    environment DOCKER_ORG: dockerOrg, DOCKER_REGISTRY: dockerRegistry, TAG: commit
    commandLine 'make'
}

task pack(type: Tar) {
    dependsOn buildTemplates
    from ('install') {
        into "enmasse-${dockerImageVersion}"
    }
    compression = Compression.GZIP
    archiveName "enmasse-${dockerImageVersion}.tgz"
    destinationDir file('build')
}

